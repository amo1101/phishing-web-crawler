<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>FMA Crawl Status</title>

  <!-- Bootstrap CSS + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    /* Color-coded text for statuses */
    .status-running  { color: #198754; font-weight: 600; } /* green */
    .status-paused   { color: #6c757d; font-weight: 600; } /* gray  */
    .status-finished { color: #0d6efd; font-weight: 600; } /* blue  */
    .status-failed   { color: #dc3545; font-weight: 600; } /* red   */

    /* Ensure borders are visible even if other CSS overrides exist */
    .table-bordered > :not(caption) > * > * {
      border-width: 1px !important;
      border-color: rgba(0,0,0,.2) !important;
    }

    /* Optional: sticky header for wide tables */
    /* Note: 'position: sticky' may not work in all browsers (e.g., older IE/Edge).
       For best results, ensure the parent container (e.g., .table-responsive) has 'overflow: auto' or 'overflow-x: auto'. */
    thead th { position: sticky; top: 0; z-index: 2; }
  </style>
</head>
<body class="bg-light">
<div class="container-fluid py-4">
  <h1 class="mb-3">FMA Crawl Status</h1>
  {# 'now' is a template variable containing the current timestamp (string), injected by the backend for display #}
  <p class="text-muted">Last updated: {{ now }}</p>

  <div class="table-responsive">
    <table class="table table-sm table-striped table-hover table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Domain</th>
          <th>Liveness</th>
          <th>Last Seen</th>
          <th>Job Kind</th>
          <th>Live Job</th>
          <th>Live Status</th>
          <th>Wayback Jobs</th>
          <th>Wayback Status</th>
          <th>Last Heritrix Launch</th>
        </tr>
      </thead>
      <tbody>
        {% set status_map = {
          'RUNNING':'status-running',
          'PAUSED':'status-paused',
          'FINISHED':'status-finished',
          'FAILED':'status-failed',
          'STOPPING':'status-paused',
          'NONE':'text-muted',
          'UNKNOWN':'text-muted'
        } %}

        {% for row in rows %}
        <tr>
          <td><code>{{ row.domain }}</code></td>

          <td>
            {% if row.last_live_status == 'live' %}
              <span class="badge bg-success">
                <i class="bi bi-check-circle-fill"></i> live
              </span>
            {% elif row.last_live_status == 'dead' %}
              <span class="badge bg-secondary">
                <i class="bi bi-dash-circle-fill"></i> dead
              </span>
            {% else %}
              <span class="badge bg-light text-dark">
                <i class="bi bi-question-circle-fill"></i> unknown
              </span>
            {% endif %}
          </td>

          <td>{{ row.last_seen or '' }}</td>
          <td>{{ row.job_kind or '' }}</td>

          <td>
            {% if row.live_job %}
              <code data-bs-toggle="tooltip" title="Heritrix live crawl job">{{ row.live_job }}</code>
            {% endif %}
          </td>

          <td>
            {% if row.live_status %}
              <span class="{{ status_map.get(row.live_status|upper, 'text-muted') }}">
                {{ row.live_status }}
              </span>
            {% endif %}
          </td>

          <td style="max-width: 260px;">
            {% for j in row.wb_jobs %}
              <div><code data-bs-toggle="tooltip" title="Wayback replay job">{{ j }}</code></div>
            {% endfor %}
          </td>

          <td>
            {% for s in row.wb_status %}
              <div class="{{ status_map.get(s|upper, 'text-muted') }}">{{ s }}</div>
            {% endfor %}
          </td>

          <td>{{ row.last_heritrix_launch or '' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Bootstrap JS (enables tooltips) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist.bundle.min.js</script>
<script>
  // Enable tooltips
  if (window.bootstrap && bootstrap.Tooltip) {
    document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(function (el) {
      new bootstrap.Tooltip(el);
    });
  }
</script>
</body>
</html>
